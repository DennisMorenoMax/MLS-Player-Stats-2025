install.packages("readr")
install.packages("dplyr")
install.packages("ggplot2")
install.packages("devtools")
install.packages("tidyverse")
# load pkg in the current session
library(readr)
library(dplyr)
library(ggplot2)
library(tidyverse)
# install.packages("devtools")
devtools::install_github("r-lib/conflicted")
# Install soccer animate
# From: https://github.com/Dato-Futbol/soccerAnimate
remotes::install_github("Dato-Futbol/soccerAnimate")
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
url <- 'https://sportapi.mlssoccer.com/api/players/byPlayerIds/MLS-OBJ-000396,MLS-OBJ-0000CX,MLS-OBJ-0003DI,MLS-OBJ-00081N,MLS-OBJ-0001IC,MLS-OBJ-0000C1,MLS-OBJ-00056O,MLS-OBJ-0003E6,MLS-OBJ-00080N,MLS-OBJ-00057Y,MLS-OBJ-0000PC,MLS-OBJ-0000EF,MLS-OBJ-0001EU,MLS-OBJ-00016B,MLS-OBJ-0003DW,MLS-OBJ-0007XO,MLS-OBJ-0007XJ,MLS-OBJ-0000L1,MLS-OBJ-00000X,MLS-OBJ-0000CP,MLS-OBJ-0003EO,MLS-OBJ-000397,MLS-OBJ-000817,MLS-OBJ-0000MF,MLS-OBJ-00053S,MLS-OBJ-00053V,MLS-OBJ-0007TI,MLS-OBJ-0007XP,MLS-OBJ-0007KJ,MLS-OBJ-0005D9?culture=en-us'
res <- httr::GET(url)
stop_for_status(res)
data <- jsonlite::fromJSON(content(res, "text"))
View(data)
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
#url <- 'https://sportapi.mlssoccer.com/api/players/byPlayerIds/MLS-OBJ-000396,MLS-OBJ-0000CX,MLS-OBJ-0003DI,MLS-OBJ-00081N,MLS-OBJ-0001IC,MLS-OBJ-0000C1,MLS-OBJ-00056O,MLS-OBJ-0003E6,MLS-OBJ-00080N,MLS-OBJ-00057Y,MLS-OBJ-0000PC,MLS-OBJ-0000EF,MLS-OBJ-0001EU,MLS-OBJ-00016B,MLS-OBJ-0003DW,MLS-OBJ-0007XO,MLS-OBJ-0007XJ,MLS-OBJ-0000L1,MLS-OBJ-00000X,MLS-OBJ-0000CP,MLS-OBJ-0003EO,MLS-OBJ-000397,MLS-OBJ-000817,MLS-OBJ-0000MF,MLS-OBJ-00053S,MLS-OBJ-00053V,MLS-OBJ-0007TI,MLS-OBJ-0007XP,MLS-OBJ-0007KJ,MLS-OBJ-0005D9?culture=en-us'
url2 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=1'
res <- httr::GET(url2)
stop_for_status(res)
data <- jsonlite::fromJSON(content(res, "text"))
View(data)
View(res)
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
#url <- 'https://sportapi.mlssoccer.com/api/players/byPlayerIds/MLS-OBJ-000396,MLS-OBJ-0000CX,MLS-OBJ-0003DI,MLS-OBJ-00081N,MLS-OBJ-0001IC,MLS-OBJ-0000C1,MLS-OBJ-00056O,MLS-OBJ-0003E6,MLS-OBJ-00080N,MLS-OBJ-00057Y,MLS-OBJ-0000PC,MLS-OBJ-0000EF,MLS-OBJ-0001EU,MLS-OBJ-00016B,MLS-OBJ-0003DW,MLS-OBJ-0007XO,MLS-OBJ-0007XJ,MLS-OBJ-0000L1,MLS-OBJ-00000X,MLS-OBJ-0000CP,MLS-OBJ-0003EO,MLS-OBJ-000397,MLS-OBJ-000817,MLS-OBJ-0000MF,MLS-OBJ-00053S,MLS-OBJ-00053V,MLS-OBJ-0007TI,MLS-OBJ-0007XP,MLS-OBJ-0007KJ,MLS-OBJ-0005D9?culture=en-us'
url2 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=1'
url3 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=2'
res <- httr::GET(url3)
stop_for_status(res)
data3 <- jsonlite::fromJSON(content(res, "text"))
View(data)
View(data3)
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
#url <- 'https://sportapi.mlssoccer.com/api/players/byPlayerIds/MLS-OBJ-000396,MLS-OBJ-0000CX,MLS-OBJ-0003DI,MLS-OBJ-00081N,MLS-OBJ-0001IC,MLS-OBJ-0000C1,MLS-OBJ-00056O,MLS-OBJ-0003E6,MLS-OBJ-00080N,MLS-OBJ-00057Y,MLS-OBJ-0000PC,MLS-OBJ-0000EF,MLS-OBJ-0001EU,MLS-OBJ-00016B,MLS-OBJ-0003DW,MLS-OBJ-0007XO,MLS-OBJ-0007XJ,MLS-OBJ-0000L1,MLS-OBJ-00000X,MLS-OBJ-0000CP,MLS-OBJ-0003EO,MLS-OBJ-000397,MLS-OBJ-000817,MLS-OBJ-0000MF,MLS-OBJ-00053S,MLS-OBJ-00053V,MLS-OBJ-0007TI,MLS-OBJ-0007XP,MLS-OBJ-0007KJ,MLS-OBJ-0005D9?culture=en-us'
url2 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=1'
url3 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=2'
url2 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=1'
34 pages
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
#url <- 'https://sportapi.mlssoccer.com/api/players/byPlayerIds/MLS-OBJ-000396,MLS-OBJ-0000CX,MLS-OBJ-0003DI,MLS-OBJ-00081N,MLS-OBJ-0001IC,MLS-OBJ-0000C1,MLS-OBJ-00056O,MLS-OBJ-0003E6,MLS-OBJ-00080N,MLS-OBJ-00057Y,MLS-OBJ-0000PC,MLS-OBJ-0000EF,MLS-OBJ-0001EU,MLS-OBJ-00016B,MLS-OBJ-0003DW,MLS-OBJ-0007XO,MLS-OBJ-0007XJ,MLS-OBJ-0000L1,MLS-OBJ-00000X,MLS-OBJ-0000CP,MLS-OBJ-0003EO,MLS-OBJ-000397,MLS-OBJ-000817,MLS-OBJ-0000MF,MLS-OBJ-00053S,MLS-OBJ-00053V,MLS-OBJ-0007TI,MLS-OBJ-0007XP,MLS-OBJ-0007KJ,MLS-OBJ-0005D9?culture=en-us'
url2 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=1'
url3 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=2'
url2 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=1'
#34 pages
res <- httr::GET(url3)
stop_for_status(res)
data3 <- jsonlite::fromJSON(content(res, "text"))
View(data3)
setwd("C:/Users/dejom/Downloads")
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
# Function to fetch a single page
get_mls_page <- function(page_num) {
url <- paste0(
"https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/",
"season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=", page_num
)
res <- httr::GET(url)
stop_for_status(res)
data <- jsonlite::fromJSON(content(res, "text"))
return(data$players)
}
# Function to expand nested lists
expand_lists <- function(df) {
repeat {
list_cols <- names(df)[sapply(df, function(x) is.list(x) || is.matrix(x))]
if (length(list_cols) == 0) break
for (col in list_cols) {
df <- df %>% unnest_wider(all_of(col), names_sep = paste0("_", col))
}
}
return(df)
}
# Loop through pages 1 to 34
all_pages <- list()
for (i in 1:34) {
message("Fetching page ", i)
page_data <- get_mls_page(i)
all_pages[[i]] <- page_data
}
# Combine all pages into one tibble
player_stats_full <- bind_rows(all_pages) %>% expand_lists()
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
# Fetch a single page
get_mls_page <- function(page_num) {
url <- paste0(
"https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/",
"season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=", page_num
)
res <- httr::GET(url)
stop_for_status(res)
data <- jsonlite::fromJSON(content(res, "text"))
# Make sure it's a tibble
if (length(data$players) == 0) {
return(tibble())  # empty tibble if no data
} else {
return(as_tibble(data$players))
}
}
# Expand nested lists safely
expand_lists_safe <- function(df) {
while (any(sapply(df, is.list))) {
list_cols <- names(df)[sapply(df, is.list)]
for (col in list_cols) {
df <- df %>% unnest_wider(all_of(col), names_sep = paste0("_", col))
}
}
return(df)
}
# Loop through pages
all_pages <- lapply(1:34, function(i) {
message("Fetching page ", i)
get_mls_page(i)
})
# Combine all pages
player_stats_full <- bind_rows(all_pages)
# Flatten nested columns
player_stats_full <- expand_lists_safe(player_stats_full)
# Save CSV
write_csv(player_stats_full, "mls_2025_player_stats_all_pages.csv")
View(all_pages)
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
# Function to fetch player stats for a given page
get_mls_page <- function(page_num) {
url <- paste0(
"https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/",
"season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=", page_num
)
res <- httr::GET(url)
stop_for_status(res)
data <- jsonlite::fromJSON(content(res, "text"))
# Convert player_statistics to tibble
if (length(data$players) == 0) return(tibble())
as_tibble(data$players)
}
# Expand nested columns (your original function)
expand_lists <- function(df) {
repeat {
list_cols <- names(df)[sapply(df, function(x) is.list(x) || is.matrix(x))]
if (length(list_cols) == 0) break
for (col in list_cols) {
df <- df %>% unnest_wider(all_of(col), names_sep = paste0("_", col))
}
}
return(df)
}
# Loop through pages 1 to 34 and stack
all_pages <- list()
for (i in 1:34) {
message("Fetching page ", i)
page_data <- get_mls_page(i)
all_pages[[i]] <- page_data
}
# Combine all pages into one tibble
player_stats_full <- bind_rows(all_pages)
# Expand nested columns
player_stats_full <- expand_lists(player_stats_full)
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
#url <- 'https://sportapi.mlssoccer.com/api/players/byPlayerIds/MLS-OBJ-000396,MLS-OBJ-0000CX,MLS-OBJ-0003DI,MLS-OBJ-00081N,MLS-OBJ-0001IC,MLS-OBJ-0000C1,MLS-OBJ-00056O,MLS-OBJ-0003E6,MLS-OBJ-00080N,MLS-OBJ-00057Y,MLS-OBJ-0000PC,MLS-OBJ-0000EF,MLS-OBJ-0001EU,MLS-OBJ-00016B,MLS-OBJ-0003DW,MLS-OBJ-0007XO,MLS-OBJ-0007XJ,MLS-OBJ-0000L1,MLS-OBJ-00000X,MLS-OBJ-0000CP,MLS-OBJ-0003EO,MLS-OBJ-000397,MLS-OBJ-000817,MLS-OBJ-0000MF,MLS-OBJ-00053S,MLS-OBJ-00053V,MLS-OBJ-0007TI,MLS-OBJ-0007XP,MLS-OBJ-0007KJ,MLS-OBJ-0005D9?culture=en-us'
url2 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=1'
url3 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=2'
url2 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=1'
url4 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals'
#34 pages
res <- httr::GET(url4)
stop_for_status(res)
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
#url <- 'https://sportapi.mlssoccer.com/api/players/byPlayerIds/MLS-OBJ-000396,MLS-OBJ-0000CX,MLS-OBJ-0003DI,MLS-OBJ-00081N,MLS-OBJ-0001IC,MLS-OBJ-0000C1,MLS-OBJ-00056O,MLS-OBJ-0003E6,MLS-OBJ-00080N,MLS-OBJ-00057Y,MLS-OBJ-0000PC,MLS-OBJ-0000EF,MLS-OBJ-0001EU,MLS-OBJ-00016B,MLS-OBJ-0003DW,MLS-OBJ-0007XO,MLS-OBJ-0007XJ,MLS-OBJ-0000L1,MLS-OBJ-00000X,MLS-OBJ-0000CP,MLS-OBJ-0003EO,MLS-OBJ-000397,MLS-OBJ-000817,MLS-OBJ-0000MF,MLS-OBJ-00053S,MLS-OBJ-00053V,MLS-OBJ-0007TI,MLS-OBJ-0007XP,MLS-OBJ-0007KJ,MLS-OBJ-0005D9?culture=en-us'
url2 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=1'
url3 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=2'
url2 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=1'
url4 <- 'https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30'
#34 pages
res <- httr::GET(url4)
stop_for_status(res)
data3 <- jsonlite::fromJSON(content(res, "text"))
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
# Function to fetch a single page
get_mls_page <- function(page_num) {
url <- paste0(
"https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/",
"season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=", page_num
)
res <- httr::GET(url)
stop_for_status(res)
data <- jsonlite::fromJSON(content(res, "text"))
# Return player_statistics as data.frame, skip empty pages
if (length(data$players) == 0) return(NULL)
as.data.frame(data$players)
}
# Your original expand_lists function
expand_lists <- function(df) {
repeat {
list_cols <- names(df)[sapply(df, function(x) is.list(x) || is.matrix(x))]
if (length(list_cols) == 0) break
for (col in list_cols) {
df <- df %>% unnest_wider(all_of(col), names_sep = paste0("_", col))
}
}
return(df)
}
# Loop through pages 1 to 34
all_pages <- list()
for (i in 1:34) {
message("Fetching page ", i)
page_data <- get_mls_page(i)
if (!is.null(page_data)) {            # Only add non-empty pages
all_pages[[length(all_pages) + 1]] <- page_data
}
}
# Combine all pages
player_stats_full <- bind_rows(all_pages)
# Expand nested lists
player_stats_full <- expand_lists(player_stats_full)
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
get_mls_data <- function(page = 1) {
url <- paste0("https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=", page)
res <- httr::GET(url)
stop_for_status(res)
data <- jsonlite::fromJSON(content(res, "text"))
season_info <- as_tibble(data$stats_info)
player_stats <- as_tibble(data$player_statistics)
list(season_info = season_info, player_stats = player_stats)
}
expand_lists <- function(df) {
repeat {
list_cols <- names(df)[sapply(df, function(x) is.list(x) || is.matrix(x))]
if (length(list_cols) == 0) break
for (col in list_cols) {
df <- df %>% unnest_wider(all_of(col), names_sep = paste0("_", col))
}
}
return(df)
}
# Initialize empty tibble to store all pages
all_player_stats <- tibble()
# Loop through pages
for (page in 1:34) {
message("Fetching page ", page, "...")
mls <- get_mls_data(page)
# Expand nested columns
player_stats_expanded <- expand_lists(mls$player_stats)
# Bind to main dataset
all_player_stats <- bind_rows(all_player_stats, player_stats_expanded)
}
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
get_mls_data <- function(page = 1) {
url <- paste0(
"https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=",
page
)
res <- httr::GET(url)
stop_for_status(res)
data <- jsonlite::fromJSON(content(res, "text"), simplifyVector = FALSE)
season_info <- as_tibble(data$stats_info)
player_stats <- data$player_statistics
# Ensure it's a tibble even if empty
if (length(player_stats) == 0) {
player_stats <- tibble()
} else {
player_stats <- as_tibble(player_stats)
}
list(season_info = season_info, player_stats = player_stats)
}
expand_lists <- function(df) {
if (nrow(df) == 0) return(df)  # Skip empty data frames
repeat {
# Only select columns that are actually lists or matrices
list_cols <- names(df)[sapply(df, function(x) is.list(x) || is.matrix(x))]
if (length(list_cols) == 0) break
for (col in list_cols) {
# Try-catch to avoid errors in weird columns
try({
df <- df %>% unnest_wider(all_of(col), names_sep = paste0("_", col))
}, silent = TRUE)
}
}
return(df)
}
# Initialize empty tibble to store all pages
all_player_stats <- tibble()
# Loop through pages
for (page in 1:34) {
message("Fetching page ", page, "...")
mls <- get_mls_data(page)
player_stats_expanded <- expand_lists(mls$player_stats)
# Only bind if not empty
if (nrow(player_stats_expanded) > 0) {
all_player_stats <- bind_rows(all_player_stats, player_stats_expanded)
}
}
# Season info from first page
season_info_expanded <- expand_lists(get_mls_data(1)$season_info)
season_year <- season_info_expanded$season
# Save CSVs
write_csv(all_player_stats, paste0("mls_", season_year, "_player_stats.csv"))
write_csv(season_info_expanded, paste0("mls_season_", season_year, "_info.csv"))
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
get_mls_data <- function(page = 1) {
url <- paste0(
"https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page=",
page
)
res <- httr::GET(url)
stop_for_status(res)
data <- jsonlite::fromJSON(content(res, "text"), flatten = TRUE)  # <-- flatten nested lists
season_info <- as_tibble(data$stats_info)
player_stats <- as_tibble(data$player_statistics)
list(season_info = season_info, player_stats = player_stats)
}
# Initialize empty tibble to store all pages
all_player_stats <- tibble()
# Loop through pages until no data is returned
page <- 1
repeat {
message("Fetching page ", page, "...")
mls <- get_mls_data(page)
player_stats <- mls$player_stats
if (nrow(player_stats) == 0) break  # stop if no more data
all_player_stats <- bind_rows(all_player_stats, player_stats)
page <- page + 1
}
# Get season info from first page
season_info <- get_mls_data(1)$season_info
season_year <- season_info$season
# Save CSVs
write_csv(all_player_stats, paste0("mls_", season_year, "_player_stats.csv"))
write_csv(season_info, paste0("mls_season_", season_year, "_info.csv"))
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
base_url <- "https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page="
all_pages <- 1:34
for (page in all_pages) {
url <- paste0(base_url, page)
print(url)  # This will print each URL from page 1 to 34
res <- httr::GET(url)
stop_for_status(res)
data <- jsonlite::fromJSON(content(res, "text"), flatten = TRUE)  # <-- flatten nested lists
season_info <- as_tibble(data$stats_info)
player_stats <- as_tibble(data$player_statistics)
list(player_stats = player_stats)
}
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
base_url <- "https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page="
all_pages <- 1:34
for (page in all_pages) {
url <- paste0(base_url, page)
print(url)  # This will print each URL from page 1 to 34
res <- httr::GET(url)
stop_for_status(res)
data <- jsonlite::fromJSON(content(res, "text"))  # <-- flatten nested lists
player_stats <- as_tibble(data$player_statistics)
list(player_stats = player_stats)
}
library(httr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(readr)
base_url <- "https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page="
all_pages <- 1:34
for (page in all_pages) {
url <- paste0(base_url, page)
print(url)  # This will print each URL from page 1 to 34
res <- httr::GET(url)
stop_for_status(res)
data <- jsonlite::fromJSON(content(res, "text"), flatten = TRUE)  # <-- flatten nested lists
player_stats <- as_tibble(data$player_statistics)
list(player_stats = player_stats)
}
View(data)
setwd("C:/Users/dejom/Downloads")
library(httr)
library(jsonlite)
library(dplyr)
library(readr)
base_url <- "https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page="
all_pages <- 1:34
# Initialize empty tibble to store all pages
all_data <- tibble()
for (page in all_pages) {
url <- paste0(base_url, page)
message("Fetching page ", page, "...")
res <- httr::GET(url)
stop_for_status(res)
# Convert JSON to R object (already flattened)
data <- jsonlite::fromJSON(content(res, "text"), flatten = TRUE)
# Convert to tibble (if not already)
data_tibble <- as_tibble(data)
# Stack it
all_data <- bind_rows(all_data, data_tibble)
}
# Save CSV
write_csv(all_data, "mls_all_pages_data.csv")
View(res)
setwd("C:/Users/dejom/Downloads/player_MLS25_R")
library(httr)
library(jsonlite)
library(dplyr)
library(readr)
base_url <- "https://sportapi.mlssoccer.com/api/stats/players/competition/MLS-COM-000001/season/MLS-SEA-0001K9/order/goals/desc?pageSize=30&page="
all_pages <- 1:34
# Initialize empty tibble to store all pages
all_data <- tibble()
for (page in all_pages) {
url <- paste0(base_url, page)
message("Fetching page ", page, "...")
res <- httr::GET(url)
stop_for_status(res)
# Convert JSON to R object (already flattened) therefore no need to expand list
data <- jsonlite::fromJSON(content(res, "text"), flatten = TRUE)
# Convert to tibble (if not already)
data_tibble <- as_tibble(data)
# Stack it
all_data <- bind_rows(all_data, data_tibble)
}
# Save CSV
write_csv(all_data, "mls_2025_player_stats.csv")
